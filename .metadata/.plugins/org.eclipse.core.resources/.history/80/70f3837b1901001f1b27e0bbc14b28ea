<%@page import="java.security.ProtectionDomain"%>
<%@page import="java.util.ArrayList"%>
<%@page import="java.util.List"%>
<%@page import="shop.dto.Product"%>
<%@page import="shop.dao.ProductRepository"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>장바구니 pro</title>
</head>
<body>
<%
   String productId = request.getParameter("id");
   ProductRepository productDAO  = new ProductRepository();
   Product product = productDAO .getProductById(productId);
   
   
   List<Product> cartList = (List<Product>) session.getAttribute("cartList");
   
   // cartlist가 null 일 경우 새로운 카트 생성
   if (cartList == null) {
	    cartList = new ArrayList<>(); // 새로운 카트 생성
	}
%>
    
    // 조건 기존 productId가 있는지?
    boolean duplicated = false;
   
    for(int i = 0 ; i < cartList.size() ; i++ ) {
       Product cart = cartList.get(i);
       String cartProductId = cart.getProductId();
       
       if( productId.equals(cartProductId) ) {
          duplicated = true;
          int count = cart.getQuantity();
          cart.setQuantity(++count);
          break;
       }
    }
    
   if( !duplicated ) {
      product.setQuantity(1);
       cartList.add(product);
   }
    
   
   session.setAttribute("cartList", cartList);
    response.sendRedirect("products.jsp");
%>



</body>
</html>